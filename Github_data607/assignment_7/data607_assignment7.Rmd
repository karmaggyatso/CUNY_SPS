---
title: "data607_assignment7"
author: "karmaGyatso"
date: '2022-11-03'
output: html_document
---

## Assignment Information

In Text Mining with R, Chapter 2 looks at Sentiment Analysis.  In this assignment, you should start by getting the primary example code from chapter 2 working in an R Markdown document.  You should provide a citation to this base code.  You’re then asked to extend the code in two ways:

    Work with a different corpus of your choosing, and
    Incorporate at least one additional sentiment lexicon (possibly from another R package that you’ve found through research).

As usual, please submit links to both an .Rmd file posted in your GitHub repository and to your code on rpubs.com.  You make work on a small team on this assignment.




```{r}
library(tidytext)
```

```{r}
get_sentiments("bing")
```
```{r}
get_sentiments("afinn")
```

```{r}
get_sentiments("nrc")
```


```{r}
library(janeaustenr)
library(dplyr)
library(stringr)
```

```{r}
austen_books()
tidy_books <- austen_books() %>%
  group_by(book) %>%
  mutate(
    linenumber = row_number(),
    chapter = cumsum(str_detect(text, 
                                regex("^chapter [\\divxlc]", 
                                      ignore_case = TRUE)))) %>%
  ungroup() %>%
  unnest_tokens(word, text)

tidy_books
```


```{r}
nrc_joy <- get_sentiments("nrc") %>% 
  filter(sentiment == "joy")

nrc_joy
```
```{r}
tidy_books %>%
  filter(book == "Emma") %>%
  inner_join(nrc_joy) %>%
  count(word, sort = TRUE)
```

```{r}
library(tidyr)

jane_austen_sentiment <- tidy_books %>%
  inner_join(get_sentiments("bing")) %>%
  count(book, index = linenumber %/% 80, sentiment) %>%
  pivot_wider(names_from = sentiment, values_from = n, values_fill = 0) %>% 
  mutate(sentiment = positive - negative)


jane_austen_sentiment
```
```{r}
library(ggplot2)

ggplot(jane_austen_sentiment, aes(index, sentiment, fill = book)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~book, ncol = 2, scales = "free_x")
```
##2.2 Comparing the three sentiment dictionaries

```{r}
pride_prejudice <- tidy_books %>% 
  filter(book == "Pride & Prejudice")

pride_prejudice
```

```{r}
afinn <- pride_prejudice %>% 
  inner_join(get_sentiments("afinn")) %>% 
  group_by(index = linenumber %/% 80) %>% 
  summarise(sentiment = sum(value)) %>% 
  mutate(method = "AFINN")

afinn
```
```{r}
bing_and_nrc <- bind_rows(
  pride_prejudice %>% 
    inner_join(get_sentiments("bing")) %>%
    mutate(method = "Bing et al."),
  pride_prejudice %>% 
    inner_join(get_sentiments("nrc") %>% 
                 filter(sentiment %in% c("positive", 
                                         "negative"))
    ) %>%
    mutate(method = "NRC")) %>%
  count(method, index = linenumber %/% 80, sentiment) %>%
  pivot_wider(names_from = sentiment,
              values_from = n,
              values_fill = 0) %>% 
  mutate(sentiment = positive - negative)

bing_and_nrc
```

```{r}
bind_rows(afinn, 
          bing_and_nrc) %>%
  ggplot(aes(index, sentiment, fill = method)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~method, ncol = 1, scales = "free_y")
```
```{r}
get_sentiments("nrc") %>% 
  filter(sentiment %in% c("positive", "negative")) %>% 
  count(sentiment)
```

```{r}
get_sentiments("bing") %>% 
  count(sentiment)
```

## 2.4 Most common positive and negative words 

```{r}
bing_word_counts <- tidy_books %>%
  inner_join(get_sentiments("bing")) %>%
  count(word, sentiment, sort = TRUE) %>%
  ungroup()

bing_word_counts
```

```{r}
bing_word_counts %>%
  group_by(sentiment) %>%
  slice_max(n, n = 10) %>% 
  ungroup() %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(n, word, fill = sentiment)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~sentiment, scales = "free_y") +
  labs(x = "Contribution to sentiment",
       y = NULL)
```

```{r}
custom_stop_words <- bind_rows(tibble(word = c("miss"),  
                                      lexicon = c("custom")), 
                               stop_words)

custom_stop_words

```

##2.5 Wordclouds

```{r}
library(wordcloud)

tidy_books %>%
  anti_join(stop_words) %>%
  count(word) %>%
  with(wordcloud(word, n, max.words = 100))
```

```{r}
library(reshape2)

tidy_books %>%
  inner_join(get_sentiments("bing")) %>%
  count(word, sentiment, sort = TRUE) %>%
  acast(word ~ sentiment, value.var = "n", fill = 0) %>%
  comparison.cloud(colors = c("gray20", "gray80"),
                   max.words = 100)
```


## 2.6 Looking at units beyond just words 

```{r}
p_and_p_sentences <- tibble(text = prideprejudice) %>% 
  unnest_tokens(sentence, text, token = "sentences")
```

```{r}
p_and_p_sentences$sentence[2]

```

```{r}
austen_chapters <- austen_books() %>%
  group_by(book) %>%
  unnest_tokens(chapter, text, token = "regex", 
                pattern = "Chapter|CHAPTER [\\dIVXLC]") %>%
  ungroup()
```

```{r}
austen_chapters %>% 
  group_by(book) %>% 
  summarise(chapters = n())
```
```{r}
bingnegative <- get_sentiments("bing") %>% 
  filter(sentiment == "negative")

wordcounts <- tidy_books %>%
  group_by(book, chapter) %>%
  summarize(words = n())

tidy_books %>%
  semi_join(bingnegative) %>%
  group_by(book, chapter) %>%
  summarize(negativewords = n()) %>%
  left_join(wordcounts, by = c("book", "chapter")) %>%
  mutate(ratio = negativewords/words) %>%
  filter(chapter != 0) %>%
  slice_max(ratio, n = 1) %>% 
  ungroup()
```

## Extended analysis on *The Scarlet Letter*
Determining the gutenberg_id from the *gutenberg_works()* based on the title name given. We can look up for the *gutenbergr_id* from *gutenberg_works* or *gutenberg_metadata*.
```{r}
library("gutenbergr")

gutenberg_works() |>
  filter(title == "The Scarlet Letter")
```
Downloading the *The Scarlet Letter* from *gutenberg_download()*
```{r}
scarlett_letter <- gutenberg_download(33)
```
```{r}
# assigning only text column values to text variable
text <- tibble(line = 1:nrow(scarlett_letter), scarlett_letter$text)

colnames(text) <- c('lines', 'text')


clean_book <- text |>
  unnest_tokens(word, text) #splits a columns into tokens

#counting list of positive words
clean_book |> 
  inner_join(get_sentiments("bing")) |>
  count(word, sort = TRUE)
  
``` 

```{r}

#counting and forming workcloud postive words
clean_book |>
  anti_join(stop_words) |>
  count(word) |>
  with(wordcloud(word, n, max.words = 100))
```

```{r}

#creating wordcloud for negative words
clean_book |>
  inner_join(get_sentiments("nrc")) |>
  anti_join(stop_words) |>
  count(word) |>
  with(wordcloud(word, n, max.words = 100))
```

```{r}
bing_word_counts <- clean_book %>%
  inner_join(get_sentiments("bing")) %>%
  count(word, sentiment, sort=TRUE)
```


```{r}
bing_word_counts %>%
  group_by(sentiment) %>%
  top_n(10) %>%
  ggplot(aes(reorder(word, n), n, fill = sentiment)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  facet_wrap(~sentiment, scales = "free_y") +
  labs(y = "Contribution to sentiment", x = NULL) +
  coord_flip()
```
## Conclusion

I haven't read **The Scarlet Letter** but the description of the book explains about regrets of the narrator. First I thought there would be plenty of negative emotions across the book but it seems like there are more positive words than expected within *top 10* rows. 

Reference: 

David Robinson, J. S. (n.d.). 2 Sentiment analysis with tidy data | Text Mining with R. 2 Sentiment Analysis With Tidy Data | Text Mining With R. Retrieved November 6, 2022, from https://www.tidytextmining.com/sentiment.html


Hawthorne. (2008, May 5). The Project Gutenberg eBook of The Scarlet Letter, by Nathaniel Hawthorne. The Project Gutenberg eBook of the Scarlet Letter, by Nathaniel Hawthorne. Retrieved November 6, 2022, from https://www.gutenberg.org/files/25344/25344-h/25344-h.htm


